var EnCoderXhr = new XMLHttpRequest();
      EnCoderXhr.onreadystatechange = function(){
        if(EnCoderXhr.readyState == 4){
          var param = JSON.parse(EnCoderXhr.response);
          setMaxDigits(130);
          var encrypPublicKey = new RSAKeyPair(param.publicExponent,'',param.modulus);
          var pwd = encryptedString(encrypPublicKey,encodeURIComponent(password));
          var body = {'loginName':user,'password':pwd,'encoder':param.encoder};
          body = JSON.stringify(body);
          var LoginXhr = new XMLHttpRequest();
          LoginXhr.onreadystatechange = function(){
            if(LoginXhr.status == 200 && LoginXhr.readyState == 4){
              var MenuList = JSON.parse(LoginXhr.response).listMenu;
              var localMenuList = JSON.stringify(MenuList);
              localStorage.setItem('listMenuForMobile',localMenuList);
              loginFlag = true;
              if (currentAwin.frameElement && currentAwin.frameElement.name == "browserFrame2" && currentAwin.frameElement.dataset.browser) {
                if (currentAwin.location.href.indexOf('login') !== -1) {
                  //currentAwin.frameElement.src = 'http://192.168.220.82:8080/pttlCrm/res/index.html'
                  //ysp.runtime.Model.setForceMatchModels(['index']);
                }
              }
              currentAwin.location.href = 'http://192.168.220.82:8080/pttlCrm/res/index.html';
              currentAwin.frameElement.src = 'http://192.168.220.82:8080/pttlCrm/res/index.html';
              ysp.runtime.Model.setForceMatchModels(['index']);
              getAllMenu(currentAwin,MenuList);
              //ysp.appMain.hideLoading();
            }
          }
          LoginXhr.open('POST','http://192.168.220.82:8080/pttlCrm/login/loginInForMobile');
          LoginXhr.send(body);
          //ysp.appMain.showLoading();
        }
      }
      EnCoderXhr.open('POST','http://192.168.220.82:8080/pttlCrm/login/getEncoderForMobile?'+user);
      EnCoderXhr.send();




      var esb = function(user,password){
    if(user&&password){
      var currentAwin = ysp.runtime.Browser.activeBrowser.contentWindow;
			var time = timeStamp() // 总线接口 时间戳
      //GetEmcoder 总线接口 key
      var Encoderkey = 'YDD6r0d00n873pj!s9A3$hB'+time;  
      Encoderkey = Base64.encode(hex_md5(Encoderkey));
      //GetEmcoder 总线接口 key
      var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function(){
        if(xhr.readyState == 4){
            var param = JSON.parse(EnCoderXhr.response);
            setMaxDigits(130);
            var encrypPublicKey = new RSAKeyPair(param.publicExponent,'',param.modulus);
            var pwd = encryptedString(encrypPublicKey,encodeURIComponent(password));
            var body = {"Header":{"APP_ID":"YDD","TIMESTAMP":time,"TOKEN":Encoderkey},"Body":{"VCRMRequest":{'loginName':user,'password':pwd,'encoder':param.encoder}}};
            body = JSON.stringify(body);
          //VCRMLogin  总线接口
            var LoginXhr = new XMLHttpRequest();
            LoginXhr.onreadystatechange = function(){
              if(LoginXhr.status == 200 && LoginXhr.readyState == 4){
                var MenuList = JSON.parse(LoginXhr.response).listMenu;
                var localMenuList = JSON.stringify(MenuList);
                ALLMENU = MenuList;
                localStorage.setItem('listMenuForMobile',localMenuList);
                loginFlag = true;
                getAllMenu(currentAwin,MenuList);
              }
            }
            LoginXhr.open('POST','http://192.168.220.82:8080/pttlCrm/login/loginInForMobile');
            LoginXhr.send(body);
            //ysp.appMain.showLoading();
          }
        }
      xhr.open('POST','http://219.143.43.84:8081/gateway-0298/GetEncoder',true);
      xhr.send(JSON.stringify({"Header":{"APP_ID":"YDD","TIMESTAMP":time,"TOKEN":Encoderkey},"Body":{"VCRMRequest":{"user":user}}}))
  }
  }